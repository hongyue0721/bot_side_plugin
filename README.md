# 📝 MaiBot 博客发布插件 (Blog Publish Plugin)

> 让你的 MaiBot 拥有写博客的能力！支持通过 QQ 指令发布文章，或者让 AI 自动根据话题、聊天记录定时生成并发布博客。

## ✨ 核心功能

*   **🤖 智能写作**：
    *   **话题生成**：给它一个主题（如“早安”），AI 会自动发散思维，写出一篇生动有趣的博客。
    *   **每日总结**：自动读取当天的群聊记录，生成一篇“今日日记”，记录大家的互动点滴。
    *   **字数控制**：智能控制文章篇幅，支持随机字数浮动（让文章更自然），太短会自动重写，保证质量。
*   **⏰ 多任务定时**：
    *   支持设置多个定时任务（例如：早上 8 点发早安，晚上 11 点发总结）。
    *   **错过补发**：如果 Bot 宕机错过了时间，重启后会自动补发（不会漏掉日记）。
*   **🖥️ 可视化配置**：
    *   完美支持 MaiBoot WebUI，可以在网页上直接添加任务、修改密码，无需手动改文件。
*   **🔌 双模发布**：
    *   **远程模式**：通过 API 发布到你的独立博客网站。
    *   **本地模式**：如果没有网站，也可以直接保存为本地 JSON 文件。
*   **🧹 自动清理**：
    *   发布成功后，Bot 会自动删除你的指令消息，保持聊天记录清爽，不污染上下文。

## 📦 部署教程（小白向）

### 第一步：安装插件
1.  找到你的 MaiBot 目录，进入 `plugins` 文件夹。
2.  将本插件文件夹 `bot_side_plugin` 复制进去。
   （确保文件夹里有 `_manifest.json`, `plugin.py` 等文件）

### 第二步：安装依赖
插件需要一些额外的 Python 库才能运行。
1.  在 MaiBot 根目录下打开终端（CMD 或 PowerShell）。
2.  输入以下命令并回车：
    ```bash
    pip install -r plugins/bot_side_plugin/requirements.txt
    ```
    *如果提示 pip 不是内部命令，请尝试 `python -m pip ...`*

### 第三步：配置插件
推荐使用 **WebUI** 进行配置（最简单）：
1.  启动 MaiBot。
2.  在浏览器打开 MaiBot 的管理后台（通常是 `http://127.0.0.1:8080`）。
3.  进入 **插件管理** -> **配置** -> 找到 **QQ 发布博客**。
4.  **关键配置项**：
    *   **启用插件**：打钩。
    *   **管理员 QQ**：输入你的 QQ 号（只有你能发指令）。
    *   **博客 API 地址**：如果你有博客网站（blog_side_api），填入地址（如 `http://127.0.0.1:8000`）；如果没有，保持默认即可（会存到本地）。
    *   **定时任务列表**：
        *   点击“添加一项”。
        *   **时间**：填入 `08:00`。
        *   **类型**：选择 `topic`（话题）或 `summary`（总结）。
        *   **话题**：如果是 topic 类型，填入灵感词（如“早安”）。
5.  保存配置，重启 MaiBot 生效。

---

## 🎮 使用指南

### 1. QQ 指令（仅管理员）
在 QQ 群或私聊中发送以下指令：

*   **发布文章**：
    ```
    /blog publish 我的标题 | 这里是正文内容...
    ```
*   **让 AI 写文章**：
    ```
    /blog generate 周末去哪玩
    ```
    *(Bot 会以“周末去哪玩”为灵感，自动写一篇博客并发布)*

### 2. 定时任务详解
你可以在配置中设置多个自动任务，Bot 会在后台默默执行：

| 任务类型 | 说明 | 适用场景 |
| :--- | :--- | :--- |
| **topic (话题)** | 根据设定的词（如“早安”）自由发挥写作 | 每日问候、心情随笔 |
| **summary (总结)** | 读取当天的群聊记录，总结成日记 | 记录群友的沙雕日常 |
| **queue (队列)** | 读取预设文件中的内容发送（高级用法） | 精确控制发布内容 |

### 3. 常见问题

**Q: 为什么定时任务没反应？**
A: 请检查：
1. 配置中 `schedule.enabled` 是否已开启。
2. `timezone` 是否设置正确（默认 Asia/Shanghai）。
3. Bot 是否一直运行。如果错过了时间，Bot 重启后会尝试补发一次。

**Q: 我没有博客网站，还能用吗？**
A: 可以！插件默认支持“本地模式”。发布的文章会保存在 `blog_side_api/data/posts.json` 文件中，你可以手动查看或自己写个前端来展示。

---

## 📂 目录结构说明
```
bot_side_plugin/
├── _manifest.json         # 插件身份证（MaiBot 识别用）
├── plugin.py              # 插件主程序
├── config.example.toml    # 配置文件模板
├── content_generator.py   # AI 写作核心逻辑
├── scheduler.py           # 定时任务调度器
└── publish_command.py     # QQ 指令处理
```

## 📄 License
MIT License
